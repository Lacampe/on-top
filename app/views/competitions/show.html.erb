<div class="competition-container">
  <div class="board-container">

    <div class="board-header flexbox text-center">
      <h1><%= @competition.name %>
        <%= @competition.sport.name %>,
        <%= @competition.category %>,
        <%= @competition.number_of_players %> players,
        <%= @competition.status %>
        <%= @competition.creator.first_name %> <%= @competition.creator.last_name %>,
        Winner: <%= @competition.champion %>
      </p>
    </div>

    <div class="wrapper-competition-table">
      <% if @competition.category == "Knockout" %>
      <%= render 'knockout_competition' %>
      <% else %>
      <%= render 'league_competition' %>
      <% end %>
    </div>
  </div>


  <div class="chat-container">
    <h4>Message Board</h4>
    <div id="messages">
      <ul id="message-list">
        <% @chat_room.messages.order("created_at asc").each do |message| %>
        <%= render message, message: message %>
        <% end %>
      </ul>
    </div>
    <%= render 'messages/form', competition: @competition, message: @message %>
  </div>
</div>

<% content_for(:after_js) do %>
<script>
  $(document).ready(function() {

    // this code makes it so it load the chat at the bottom of the page
    $('#messages').scrollTop($('#messages')[0].scrollHeight)

    // this code is for the ActionCable
    App.messages = App.cable.subscriptions.create('MessagesChannel', {
      received: function(data) {
        return $('#messages ul').append(this.renderMessage(data)),
    // scrolling to bottom of page with every message render
    $('#messages').scrollTop($('#messages')[0].scrollHeight)
    },
    // how the message displays
    renderMessage: function(data) {
      return "<li><div class='message'> \
      <div class='message-block'> \
        <div class='row'> \
          <div class='col-md-1'> \
          </div> \
          <div class='col-md-11'> \
            <p class='message-text'> \
              <span class='text-muted'>"
                + data.user +
                "<br>"
                + data.time +
                "</span><br>"
                + data.body +
                "</p> \
              </div> \
            </div> \
          </div> \
        </div></li> ";
      }
    });

    $('[data-toggle="tooltip"]').tooltip();

});

</script>
<% end %>

