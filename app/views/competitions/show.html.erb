<div class="competition-container">
  <div class="board-container">

    <div class="board-header flexbox">
      <div class="left">
        <h1>
          <%= @competition.name %>
        </h1>
        <p><%= @competition.sport.name %>, <%= @competition.category %></p>
      </div>
      <div class="right">
        <p><span><%= @competition.number_of_players %></span> players</p>
      </div>
    </div>

    <div class="wrapper-competition-table">
      <% if @competition.category == "Knockout" %>
      <%= render 'knockout_competition' %>
      <% else %>
      <%= render 'league_competition' %>
      <% end %>
    </div>
  </div>


  <div class="chat-container">
    <div class="text-center chat-header">
      <%= image_tag "microphone.png" %>
      <h4>Discuss the game</h4>
    </div>
    <div id="messages">
      <ul id="message-list">
        <% @chat_room.messages.order("created_at asc").each do |message| %>
        <%= render message, message: message %>
        <% end %>
      </ul>
    </div>
    <%= render 'messages/form', competition: @competition, message: @message %>
  </div>
</div>

<% content_for(:after_js) do %>
<script>
  $(document).ready(function() {

    // this code makes it so it load the chat at the bottom of the page
    $('#messages').scrollTop($('#messages')[0].scrollHeight)

    // this code is for the ActionCable
    App.messages = App.cable.subscriptions.create('MessagesChannel', {
      received: function(data) {
        return $('#messages ul').append(this.renderMessage(data)),
    // scrolling to bottom of page with every message render
    $('#messages').scrollTop($('#messages')[0].scrollHeight)
    },
    // how the message displays
    renderMessage: function(data) {
      return "<li><div class='message'> \
      <div class='message-block'> \
        <div class='message-user'> \
           <span class='text-muted'>"
             + data.user +
             "<br>"
             + data.time +
             "</span><br>"
             +
          "</p> \
        </div> \
        <div class='message-bubble'><p>"
          + data.body +
          "</p> \
        </div> \
      </div>\
      </div></li> ";
      }
    });

    $('[data-toggle="tooltip"]').tooltip();

});

</script>
<% end %>

