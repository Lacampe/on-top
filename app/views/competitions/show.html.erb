<h1><%= @competition.name %></h1>
<div class="wrapper-competition">
  <div class="container-competition">
    <% round_number = 1 %>
    <% until round_number - 1 == @rounds do %>
    <div class=<%= "flex-" + "#{2 * @rounds - 1}" %>>
      <% @competition.matches.order("match_number asc").select { |r| r.round == round_number }.each do |match| %>
      <div class="card-match" id=<%= "#{match.match_number}" %>>
        <h5>Match <%=match.match_number %></h5>
        <p><%= match.players.first.first_name if match.players.first %> vs. <%= match.players.last.first_name if match.players.last != match.players.first %> </p>
        <% if match.played? %>
        <p>Winner: <%= match.winner.first_name %></p>
        <% end %>
        <%= link_to "Input Score", edit_match_path(match), class: 'btn btn-sm btn-success', 'data-toggle' => 'modal', 'data-target' => "##{match.match_number}_link" %>

      <%= render 'matches/edit', match: match %>
        </div>
      <% end %>
    </div>
    <% round_number += 1 %>
    <% end %>
  </div>
</div>

<div class="message-board">
  <div class="container">
    <div class="row">
      <div class="col-sm-6 col-sm-offset-3">
        <div class="chatbox">
          <div class="row">
            <div class="col-sm-12">
              <h4 style="text-align: center; margin: 20px;">Message Board</h4>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-10 col-sm-offset-1">
              <div id="messages">
                <ul id="message-list">
                  <% @chat_room.messages.order("created_at asc").each do |message| %>
                  <%= render message, message: message %>
                  <% end %>
                </ul>
              </div>
            </div>
          </div>

          <%= render 'messages/form', competition: @competition, message: @message %>
        </div>
      </div>
    </div>
        <div class="col-sm-2 col-sm-offset-1">
      <div class="participants">
        <div class="row">
          <div class="col-sm-12"><h4 style="text-align: center;">Participants</h4></div>
        </div>
        <div class="row">
          <div class="col-sm-12">
            <ul>
              <% @competition.players.each do |player| %>
              <li>
                <%= link_to "#{player.first_name} #{player.last_name}", user_path(player) %>
              </li>
              <% end %>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


<% content_for(:after_js) do %>
<script>
$(document).ready(function() {

// this code makes it so it load the chat at the bottom of the page
$('#messages').scrollTop($('#messages')[0].scrollHeight)

// this code is for the ActionCable
  App.messages = App.cable.subscriptions.create('MessagesChannel', {
    received: function(data) {
      return $('#messages ul').append(this.renderMessage(data)),
// scrolling to bottom of page with every message render
      $('#messages').scrollTop($('#messages')[0].scrollHeight)
    },
// how the message displays
    renderMessage: function(data) {
      return "<li><div class='message'> \
      <div class='message-block'> \
        <div class='row'> \
          <div class='col-md-1'> \
          </div> \
          <div class='col-md-11'> \
            <p class='message-text'> \
              <span class='text-muted'>"
              + data.user +
              "<br>"
              + data.time +
              "</span><br>"
              + data.body +
            "</p> \
          </div> \
        </div> \
      </div> \
  </div></li> ";
    }
  });

});

<% end %>
</script>

