<div class="navbar">

  <!-- Logo -->
  <%= link_to root_path, class: "navbar-logo" do %>
    <%= image_tag "on-top-logo.png" %>
  <% end %>

  <!-- Creation buttons -->
  <div class="navbar-middle">
    <%= button_to "Create a competition", new_competition_path, class: "navbar-competition-btn", method: :get %>
    <%= button_to "Create a team", root_path, class: "navbar-team-btn", method: :get %>
  </div>

  <!-- Right navigation -->
  <div class="navbar-right">

    <!-- Search form -->

      <%= render 'shared/searchform' %>


  <% if current_user.nil? %>
    <%= button_to "Log In", new_user_session_path, class: "navbar-competition-btn", method: :get %>
  <% else %>
    <div class='signout-button'>
      <%= button_to "Sign Out", destroy_user_session_path, class: "navbar-signout-btn", method: :delete %>
    </div>
  <% end %>
  <!-- Different navigation if user is logged in or not -->
<!--     <% if user_signed_in? %>

    <% end %> -->

  </div>



</div>

<% content_for(:after_js) do %>
    <script>
    var client = algoliasearch("<%= ENV['ALGOLIA_API'] %>", "<%= ENV['ALGOLIA_SECRET'] %>");
    var index = client.initIndex('User');

    //initialize autocomplete on search input (ID selector must match)
    autocomplete('#aa-search-input',
    { hint: false }, [{
        source: autocomplete.sources.hits(index, {hitsPerPage: 5}),
        //value to be displayed in input control after user's suggestion selection
        displayKey: function(suggestion) { return suggestion.first_name + " " + suggestion.last_name},
        //hash of templates used when rendering dataset
     templates: {
            //'suggestion' templating function used to render a single suggestion
            suggestion: function(suggestion) {
              var link = "<form action='<%= ENV['HOST'] %>users/" + suggestion.id + "/friend_requests' method='post' id='addfriend' style='color: lightgreen'> <input name='authenticity_token' value='<%= form_authenticity_token %>' type='hidden'> <button type='submit' name='user_id' value='" + suggestion.id + "' class='btn-link'>Add</button></form>";
              var card = "<span>" + "<img src=http://res.cloudinary.com/dkyjujcrz/image/upload/w_400,h_400/" + suggestion.photo.path + " alt='' class='avatar'> " +
                suggestion._highlightResult.first_name.value + " " + suggestion._highlightResult.last_name.value + "</span><span>" + link +"</span>";

              return card

            }
        }
    }]).on('autocomplete:selected', function(event, suggestion, dataset) {
        var url = "<%= ENV['HOST'] %>users/";
        // need to extract this to have different url for development vs production
        window.location.assign(url + suggestion.id)});
        // $(document).prepend("<%= flash[:notice] = "Friend request sent" %>")



    </script>
<% end %>


